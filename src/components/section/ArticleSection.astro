---
import FeaturedArticle from "../FeaturedArticle.astro";
import ArticleCard from "../ArticleCard.astro";
import { getCollection } from "astro:content";
import { contentfulClient } from "../../lib/contentful";

// Get local markdown articles
const localArticles = await getCollection("blog");

// Get Contentful articles
const contentfulResponse = await contentfulClient.getEntries({
  content_type: "blog",
  include: 10, // Include linked assets and entries
});

// Transform Contentful entries to match local article structure
const contentfulArticles = contentfulResponse.items.map((item: any) => ({
  slug: item.fields.slug,
  data: {
    title: item.fields.blog_title,
    description: item.fields.description,
    pubDate: item.fields.publishDate,
    tags: item.metadata.tags?.map((tag: any) => tag.sys.id) || [],
    image: item.fields.coverImage?.fields?.file?.url || "",
  },
  source: "contentful",
  contentfulData: item,
}));

// Combine and sort by publish date
const articles = [...localArticles, ...contentfulArticles].sort((a, b) => {
  return (
    new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );
});
---

<section class="w-full px-0 md:px-10 lg:px-0 mb-52">
  <FeaturedArticle article={articles[0]} />
  <div class="mt-4 lg:mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-8">
    {articles.slice(1, 5).map((article) => <ArticleCard article={article} />)}
  </div>
  <a
    href="/blog/page/1"
    class="block text-center text-base text-dark underline mt-20 cursor-pointer font-semibold group"
    >See More <i
      class="fa-solid fa-arrow-right-long fa-xl ml-2 rotate-45 group-hover:-rotate-45 transition duration-300"
    ></i></a
  >
</section>
